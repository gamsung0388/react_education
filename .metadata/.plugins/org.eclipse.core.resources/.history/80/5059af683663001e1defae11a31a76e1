package com.example.boardTest.File;

import java.io.File;
import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestPart;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import lombok.RequiredArgsConstructor;

@RequiredArgsConstructor
@RestController
@CrossOrigin(origins="http://localhost:3030")
public class FileController {
	
	private final FileService fileService;
	
	@PostMapping("/file/upload")    
    int insertBoard(@RequestPart(value="file", required=false) MultipartFile[] files) {
    	Map<String,Object> result = new HashMap<>();
    	    	
		String FileNames ="";
		System.out.println("paramMap =>"+files[0]);
		String _filePath = "C:/dev/gamDawn/";
		for (MultipartFile mf : files) {
			   
            String originFileName = mf.getOriginalFilename(); // 원본 파일 명
            String extension = originFileName.substring(originFileName.lastIndexOf(".")); // 파일 확장자
            long fileSize = mf.getSize(); // 파일 사이즈

            System.out.println("originFileName : " + originFileName);
            System.out.println("fileSize : " + fileSize);

            String safeFile =System.currentTimeMillis() + originFileName; // 저장할 파일명
            
            FileNames = FileNames+","+safeFile; 
            System.out.println("FieNames:"+ FileNames);
            System.out.println("filepath+safeFile:"+ _filePath+safeFile);
            
            try {
            	File f1 = new File(_filePath+safeFile);
                mf.transferTo(f1);
                
                result.put("pyscPath", _filePath);
				result.put("pyscNm", safeFile);
				result.put("origNm", originFileName);
				result.put("fileExt", extension);
				result.put("contentType", file.getContentType());
				result.put("fileSize", file.getSize());
                
            } catch (IllegalStateException e) {
                // TODO Auto-generated catch block
                e.printStackTrace();
            } catch (IOException e) {
                // TODO Auto-generated catch block
                e.printStackTrace();
            }
        }
				
        return 0;
    }
}
